<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.313">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Problem Set 02</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="Exercise_02_files/libs/clipboard/clipboard.min.js"></script>
<script src="Exercise_02_files/libs/quarto-html/quarto.js"></script>
<script src="Exercise_02_files/libs/quarto-html/popper.min.js"></script>
<script src="Exercise_02_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="Exercise_02_files/libs/quarto-html/anchor.min.js"></script>
<link href="Exercise_02_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="Exercise_02_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="Exercise_02_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="Exercise_02_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="Exercise_02_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">

  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#foreword" id="toc-foreword" class="nav-link active" data-scroll-target="#foreword">Foreword</a></li>
  <li><a href="#exercises" id="toc-exercises" class="nav-link" data-scroll-target="#exercises">Exercises</a>
  <ul>
  <li><a href="#exercise-1-bias-variance-trade-off" id="toc-exercise-1-bias-variance-trade-off" class="nav-link" data-scroll-target="#exercise-1-bias-variance-trade-off">Exercise 1: Bias-Variance Trade-Off</a>
  <ul class="collapse">
  <li><a href="#exercise-1a-data-exploration-and-manipulation" id="toc-exercise-1a-data-exploration-and-manipulation" class="nav-link" data-scroll-target="#exercise-1a-data-exploration-and-manipulation">Exercise 1a: Data exploration and manipulation</a>
  <ul class="collapse">
  <li><a href="#exercise-1a-i" id="toc-exercise-1a-i" class="nav-link" data-scroll-target="#exercise-1a-i">Exercise 1a i:</a></li>
  <li><a href="#exercise-1a-ii" id="toc-exercise-1a-ii" class="nav-link" data-scroll-target="#exercise-1a-ii">Exercise 1a ii:</a></li>
  </ul></li>
  <li><a href="#exercise-2b-training-a-simple-model" id="toc-exercise-2b-training-a-simple-model" class="nav-link" data-scroll-target="#exercise-2b-training-a-simple-model">Exercise 2b: Training a simple model</a>
  <ul class="collapse">
  <li><a href="#exercise-1b-i" id="toc-exercise-1b-i" class="nav-link" data-scroll-target="#exercise-1b-i">Exercise 1b i:</a></li>
  <li><a href="#exercise-1b-ii" id="toc-exercise-1b-ii" class="nav-link" data-scroll-target="#exercise-1b-ii">Exercise 1b ii:</a></li>
  <li><a href="#exercise-1b-iii" id="toc-exercise-1b-iii" class="nav-link" data-scroll-target="#exercise-1b-iii">Exercise 1b iii:</a></li>
  <li><a href="#exercise-1b-iv" id="toc-exercise-1b-iv" class="nav-link" data-scroll-target="#exercise-1b-iv">Exercise 1b iv:</a></li>
  </ul></li>
  <li><a href="#exercise-1c-overfitting-a-model" id="toc-exercise-1c-overfitting-a-model" class="nav-link" data-scroll-target="#exercise-1c-overfitting-a-model">Exercise 1c: Overfitting a model</a>
  <ul class="collapse">
  <li><a href="#exercise-1c-i" id="toc-exercise-1c-i" class="nav-link" data-scroll-target="#exercise-1c-i">Exercise 1c i:</a></li>
  <li><a href="#exercise-1c-ii" id="toc-exercise-1c-ii" class="nav-link" data-scroll-target="#exercise-1c-ii">Exercise 1c ii:</a></li>
  <li><a href="#exercise-1c-iii" id="toc-exercise-1c-iii" class="nav-link" data-scroll-target="#exercise-1c-iii">Exercise 1c iii:</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#intermezzo-good-practices-for-applied-machine-learning" id="toc-intermezzo-good-practices-for-applied-machine-learning" class="nav-link" data-scroll-target="#intermezzo-good-practices-for-applied-machine-learning">Intermezzo: Good practices for applied Machine Learning</a>
  <ul class="collapse">
  <li><a href="#developing-a-model-what-we-have-done-so-far" id="toc-developing-a-model-what-we-have-done-so-far" class="nav-link" data-scroll-target="#developing-a-model-what-we-have-done-so-far">Developing a model (What we have done so far!):</a></li>
  <li><a href="#developing-a-model-what-we-want-to-do-moving-forward" id="toc-developing-a-model-what-we-want-to-do-moving-forward" class="nav-link" data-scroll-target="#developing-a-model-what-we-want-to-do-moving-forward">Developing a model (What we want to do moving forward!):</a></li>
  </ul></li>
  <li><a href="#exercise-2-cross-validation" id="toc-exercise-2-cross-validation" class="nav-link" data-scroll-target="#exercise-2-cross-validation">Exercise 2: Cross-Validation</a>
  <ul class="collapse">
  <li><a href="#exercise-2a" id="toc-exercise-2a" class="nav-link" data-scroll-target="#exercise-2a">Exercise 2a:</a>
  <ul class="collapse">
  <li><a href="#exercise-2a-i" id="toc-exercise-2a-i" class="nav-link" data-scroll-target="#exercise-2a-i">Exercise 2a: i</a></li>
  <li><a href="#exercise-2a-ii" id="toc-exercise-2a-ii" class="nav-link" data-scroll-target="#exercise-2a-ii">Exercise 2a ii:</a></li>
  <li><a href="#exercise-2a-iii" id="toc-exercise-2a-iii" class="nav-link" data-scroll-target="#exercise-2a-iii">Exercise 2a iii:</a></li>
  <li><a href="#exercise-2a-iv" id="toc-exercise-2a-iv" class="nav-link" data-scroll-target="#exercise-2a-iv">Exercise 2a iv:</a></li>
  </ul></li>
  <li><a href="#exercise-2b" id="toc-exercise-2b" class="nav-link" data-scroll-target="#exercise-2b">Exercise 2b:</a>
  <ul class="collapse">
  <li><a href="#exercise-2b-i" id="toc-exercise-2b-i" class="nav-link" data-scroll-target="#exercise-2b-i">Exercise 2b i:</a></li>
  <li><a href="#exercise-2b-ii" id="toc-exercise-2b-ii" class="nav-link" data-scroll-target="#exercise-2b-ii">Exercise 2b ii:</a></li>
  <li><a href="#exercise-2b-iii" id="toc-exercise-2b-iii" class="nav-link" data-scroll-target="#exercise-2b-iii">Exercise 2b iii:</a></li>
  <li><a href="#exercise-2b-iii-1" id="toc-exercise-2b-iii-1" class="nav-link" data-scroll-target="#exercise-2b-iii-1">Exercise 2b iii:</a></li>
  <li><a href="#exercise-2b-iv" id="toc-exercise-2b-iv" class="nav-link" data-scroll-target="#exercise-2b-iv">Exercise 2b iv:</a></li>
  </ul></li>
  <li><a href="#exercise-2c" id="toc-exercise-2c" class="nav-link" data-scroll-target="#exercise-2c">Exercise 2c:</a>
  <ul class="collapse">
  <li><a href="#exercise-2c-i" id="toc-exercise-2c-i" class="nav-link" data-scroll-target="#exercise-2c-i">Exercise 2c i:</a></li>
  <li><a href="#exercise-2c-ii" id="toc-exercise-2c-ii" class="nav-link" data-scroll-target="#exercise-2c-ii">Exercise 2c ii:</a></li>
  <li><a href="#exercise-2c-iii" id="toc-exercise-2c-iii" class="nav-link" data-scroll-target="#exercise-2c-iii">Exercise 2c iii:</a></li>
  </ul></li>
  </ul></li>
  </ul></li>
  </ul>
</nav>
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Problem Set 02</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<section id="foreword" class="level1">
<h1>Foreword</h1>
<p>In this exercise session, we want to explore different metrics for calculating losses, review linear regression, and learn how to split our data into training and test data and why that is important.</p>
</section>
<section id="exercises" class="level1">
<h1>Exercises</h1>
<div class="cell">

</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"tidyverse"</span>)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"tidymodels"</span>)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"ggtext"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="exercise-1-bias-variance-trade-off" class="level2">
<h2 class="anchored" data-anchor-id="exercise-1-bias-variance-trade-off">Exercise 1: Bias-Variance Trade-Off</h2>
<p>In the lecture, we have already briefly discussed the issue of overfitting by considering a simple example. The goal of this exercise is to examine a real-world dataset and see how we can recreate the phenomenon of under and overfitting with a simple linear model.</p>
<section id="exercise-1a-data-exploration-and-manipulation" class="level3">
<h3 class="anchored" data-anchor-id="exercise-1a-data-exploration-and-manipulation">Exercise 1a: Data exploration and manipulation</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>data_aux_filtered <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"rent_aux.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The <code>rent_aux</code> dataset is a preprocessed subset of the <a href="https://www.kaggle.com/datasets/corrieaar/apartment-rental-offers-in-germany">Apartment rental offers in Germany</a> dataset. It contains 239 unique rental listings for flats in Augsburg. The data was sourced at three different dates in 2018 and 2019 and contains 28 different variables.</p>
<p>Instead of focusing on a comprehensive data cleaning and manipulation process, we will simply use the two variables <code>livingSpace</code> measuring the area of living in <span class="math inline">\(m^2\)</span> of a listing and <code>totalRent</code> in EUR, representing the total amount of rent for a month (base rent + utilities).</p>
<section id="exercise-1a-i" class="level4">
<h4 class="anchored" data-anchor-id="exercise-1a-i">Exercise 1a i:</h4>
<p>Visualize the relationship between the two variables <code>livingSpace</code> and <code>totalRent</code>. The output could look like the plot below.</p>
<div class="cell">
<div class="cell-output-display">
<p><img src="Exercise_02_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="exercise-1a-ii" class="level4">
<h4 class="anchored" data-anchor-id="exercise-1a-ii">Exercise 1a ii:</h4>
<p>Without conducting a thorough outlier analysis we decide to remove every listing that either costs more than <span class="math inline">\(2500\)</span> EUR or is bigger than <span class="math inline">\(200\: m^2\)</span>. Use the <code>filter</code> function to remove those outliers.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>data_aux_filtered <span class="ot">&lt;-</span> data_aux_filtered <span class="sc">%&gt;%</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(totalRent <span class="sc">&lt;=</span> <span class="dv">2500</span>, livingSpace <span class="sc">&lt;=</span> <span class="dv">200</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="exercise-2b-training-a-simple-model" class="level3">
<h3 class="anchored" data-anchor-id="exercise-2b-training-a-simple-model">Exercise 2b: Training a simple model</h3>
<p>In this exercise, we want to fit an overly simple model to demonstrate itâ€™s low performance on both, a training and test set.</p>
<section id="exercise-1b-i" class="level4">
<h4 class="anchored" data-anchor-id="exercise-1b-i">Exercise 1b i:</h4>
<p>In order to ensure consistent results, we set a <code>seed</code>. Furthermore, the vector <code>sampled</code> that is filled <span class="math inline">\(70\%\)</span> with <code>TRUE</code> values and <span class="math inline">\(30 \%\)</span> <code>FALSE</code> values is given. Its length matches the length of the <code>data_aux_filtered</code> dataset. The goal is to create a simple training and testing set by randomly splitting the <code>data_aux_filtered</code> dataset into two subsets.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">2</span>)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>sampled <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="fu">c</span>(<span class="cn">TRUE</span>, <span class="cn">FALSE</span>),</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>                 <span class="fu">nrow</span>(data_aux_filtered),</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>                 <span class="at">replace=</span><span class="cn">TRUE</span>, <span class="at">prob=</span><span class="fu">c</span>(<span class="fl">0.7</span>, <span class="fl">0.3</span>)</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>                 )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="exercise-1b-i-a" class="level5">
<h5 class="anchored" data-anchor-id="exercise-1b-i-a">Exercise 1b i a:</h5>
<p>Use the vector <code>sampled</code> to create a tibble <code>rent_train</code> consisting of all samples in <code>data_aux_filtered</code> that match the position of <code>TRUE</code> values in the vector <code>sample</code>. Subsequently, create a list <code>rent_test</code> that consists of all samples in <code>data_aux_filtered</code> that match the position of <code>FALSE</code> values in the vector <code>sampled</code>.</p>
<div class="cell">

</div>
</section>
<section id="exercise-1b-i-b" class="level5">
<h5 class="anchored" data-anchor-id="exercise-1b-i-b">Exercise 1b i b:</h5>
<p>Using the <code>if_else</code> function and <code>%in%</code> operator, add a column called <code>label</code> to <code>data_aux_filtered</code> that consists of the strings <code>"train"</code> and <code>"test"</code> at the respective positions where a sample is either in <code>rent_train</code> or <code>rent_test</code>. You can use the variable <code>scoutId</code> to match the samples in <code>rent_train</code> and <code>rent_test</code> with samples in <code>data_aux_filtered</code>.</p>
<div class="cell">

</div>
</section>
</section>
<section id="exercise-1b-ii" class="level4">
<h4 class="anchored" data-anchor-id="exercise-1b-ii">Exercise 1b ii:</h4>
<p>Create a model <code>simple_model</code> using the <code>lm</code> function and fit the variable <code>totalRent</code> on <code>totalRent</code>. The underlying data should be the previously created list <code>rent_train</code>. By following this kind of weird procedure, we create a model that simply returns the mean of <code>totalRent</code> as a predictor. There will most likely be a warning that we can (at least this time) safely ignore. Also, watch out that the output of <code>lm()</code> will show a rounded value as an intercept but in further calculations, the output <code>simple_model</code> contains the exact value.</p>
<div class="cell">

</div>
</section>
<section id="exercise-1b-iii" class="level4">
<h4 class="anchored" data-anchor-id="exercise-1b-iii">Exercise 1b iii:</h4>
<p>Calculate the RMSE loss of the training set <code>rent_train</code> and the testing set <code>rent_test</code> by using the <code>loss_rmse</code> function below. The fitted values on the training set can be accessed by using <code>simple_model$fitted.values</code>. In order to predict the values of the <code>rent_train</code> set, familiarize yourself with the <code>predict</code> function. For reference, you can find some plausible values below.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>loss_rmse <span class="ot">&lt;-</span> <span class="cf">function</span>(y, yhat){</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sqrt</span>(<span class="fu">mean</span>((y <span class="sc">-</span> yhat)<span class="sc">^</span><span class="dv">2</span>))</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>Training error: 419.43

Testing error: 474.93</code></pre>
</div>
</div>
</section>
<section id="exercise-1b-iv" class="level4">
<h4 class="anchored" data-anchor-id="exercise-1b-iv">Exercise 1b iv:</h4>
<p>Complete the following code snippet such that the plot looks like the one displayed below. What does the graph below show?</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>data_aux_filtered <span class="sc">%&gt;%</span> </span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>    <span class="do">###############</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>    <span class="do">## Fill Here ##</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>    <span class="do">###############</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">3</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>)<span class="sc">+</span></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(</span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">yintercept =</span> simple_model<span class="sc">$</span>coefficients),</span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">linewidth =</span> <span class="dv">2</span></span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Living space (in sq.m)"</span>,</span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Total rent (in Euro)"</span>,</span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">'Data Set'</span>,</span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Our Model's fitted line doesn't fit particularly well"</span></span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">16</span>)<span class="sc">+</span></span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_brewer</span>(<span class="at">palette =</span> <span class="st">'Set2'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output-display">
<p><img src="Exercise_02_files/figure-html/unnamed-chunk-13-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
</section>
<section id="exercise-1c-overfitting-a-model" class="level3">
<h3 class="anchored" data-anchor-id="exercise-1c-overfitting-a-model">Exercise 1c: Overfitting a model</h3>
<p>Now that we have seen how robust (low variance) a simple model is, we will consider a more complex linear model in this exercise.</p>
<section id="exercise-1c-i" class="level4">
<h4 class="anchored" data-anchor-id="exercise-1c-i">Exercise 1c i:</h4>
<p>Create a model named <code>model</code> on the <code>rent_train</code> dataset, again, with <code>totalRent</code> as the response variable, but instead of simply using the <code>livingSpace</code> variable as a single predictor, use the <code>poly(livingSpace,20)</code> object instead.</p>
<div class="cell">

</div>
</section>
<section id="exercise-1c-ii" class="level4">
<h4 class="anchored" data-anchor-id="exercise-1c-ii">Exercise 1c ii:</h4>
<p>Calculate the RMSE. For reference, you can find some plausible values below.</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>training error: 125.43

testing error: 839.96</code></pre>
</div>
</div>
</section>
<section id="exercise-1c-iii" class="level4">
<h4 class="anchored" data-anchor-id="exercise-1c-iii">Exercise 1c iii:</h4>
<p>Explain in your own words the phenomenon observed in the following plot.</p>
<div class="cell">
<div class="cell-output-display">
<p><img src="Exercise_02_files/figure-html/unnamed-chunk-16-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
</section>
</section>
<section id="intermezzo-good-practices-for-applied-machine-learning" class="level2">
<h2 class="anchored" data-anchor-id="intermezzo-good-practices-for-applied-machine-learning">Intermezzo: Good practices for applied Machine Learning</h2>
<p>In previous courses, we mainly focused on how to fit a certain model to a given dataset. However, this process could be described as model specification, rather than model development. So, whatâ€™s the difference between specifying a model and actually building a model?</p>
<section id="developing-a-model-what-we-have-done-so-far" class="level3">
<h3 class="anchored" data-anchor-id="developing-a-model-what-we-have-done-so-far">Developing a model (What we have done so far!):</h3>
<ul>
<li><p>The given dataset has been cleaned, transformed, and manipulated using a multitude of different packages and libraries.</p></li>
<li><p>Resampling methods have been applied but training the model on each subset or newly generated dataset is usually performed by using a loop or similar methods.</p></li>
<li><p>Similar to applying resampling methods, hyperparameter tuning is applied by using a loop or similar methods.</p></li>
</ul>
<p>In summary, we have only basically specified the model we want to train and used a rather arbitrary and inconsistent approach for everything else.</p>
<p>One of the biggest issues we face, however, is when switching the model. The approach we have been using so far emphasizes working with one selected model that we wish to keep using after data preprocessing.</p>
</section>
<section id="developing-a-model-what-we-want-to-do-moving-forward" class="level3">
<h3 class="anchored" data-anchor-id="developing-a-model-what-we-want-to-do-moving-forward">Developing a model (What we want to do moving forward!):</h3>
<p>The main difference between the old approach and the new approach comes down to leveraging the advantages of the <code>{tidyverse}</code> and <code>{tidymodels}</code> frameworks. These frameworks allow for consistently preprocessing the data, setting model specifications, and performing steps like resampling and hyperparameter tuning all at once.</p>
<p>Another huge advantage is, that by following this procedure we can also swiftly switch between different ML models. For example, applying a random forest algorithm and switching to a neural network approach for the same data works is only a matter of changing a few lines of code as we will see in later exercises.</p>
<p>So where is the catch? At first, the process might seem a bit difficult or even â€œoverkillâ€ for the models we use. However, as the lecture progresses, our models will also (at least sometimes) become increasingly sophisticated. So we want to get used to this new process as early as possible in order to get used to it.</p>
<p>The biggest takeaways are:</p>
<ul>
<li><p><strong>Consistency:</strong> Independent of what the dataset or desired model looks like, we can (almost) always use the same procedure when building a model.</p></li>
<li><p><strong>Effectiveness:</strong> Once we get used to this new approach, we can develop our models a lot more effectively than before.</p></li>
<li><p><strong>Safety:</strong> Developing an ML model has many pitfalls and potholes on the way and by design, <code>{tidymodels}</code> helps us to avoid those.</p></li>
</ul>
<p>We will introduce and explore some of the aforementioned concepts in the next exercise and dive deeper in later sessions.</p>
</section>
</section>
<section id="exercise-2-cross-validation" class="level2">
<h2 class="anchored" data-anchor-id="exercise-2-cross-validation">Exercise 2: Cross-Validation</h2>
<p>Our first step down the <code>{tidymodels}</code> rabbit hole has already been broached in the lecture. By splitting the data into a training set and test set we can effectively evaluate our trained model on previously unseen data. However, how can we ensure that splitting the data once into a training set and test set yields a good model? A simple answer is: We canâ€™t.</p>
<p>That is where cross-validation comes into play.</p>
<section id="exercise-2a" class="level3">
<h3 class="anchored" data-anchor-id="exercise-2a">Exercise 2a:</h3>
<p>Similar to the lecture slides we want to build a simple model for predicting the response variable <code>totalRent</code> in Augsburg by using the single predictor <code>livingSpace</code>.</p>
<section id="exercise-2a-i" class="level4">
<h4 class="anchored" data-anchor-id="exercise-2a-i">Exercise 2a: i</h4>
<p>Familiarize yourself with the <code>initial_split</code> function and create a split named <code>split</code> on the dataset <code>data_aux_filtered</code>.</p>
<div class="cell">

</div>
</section>
<section id="exercise-2a-ii" class="level4">
<h4 class="anchored" data-anchor-id="exercise-2a-ii">Exercise 2a ii:</h4>
<p>Utilizing the newly created <code>split</code>, create the objects <code>data_train</code> and <code>data_test</code> by using the <code>training</code> and <code>testing</code> functions respectively. Note, that we are basically doing the same thing as in Exercise 1b, but instead of using the base R function <code>sample</code>, weâ€™re now working with the <code>{rsample}</code> package that is part of the <code>{tidyverse}</code> framework.</p>
<div class="cell">

</div>
</section>
<section id="exercise-2a-iii" class="level4">
<h4 class="anchored" data-anchor-id="exercise-2a-iii">Exercise 2a iii:</h4>
<p>Familiarize yourself with the functionality of the <code>vfold_cv</code> function and create an instance named <code>folds</code> with the dataset <code>data_train</code> and the parameter <code>v = 10</code>.</p>
<div class="cell">

</div>
<p>The function <code>vfold_cv</code> randomly splits the data into <code>v</code> roughly equally sized subsets. One resample then consists of <code>v-1</code> of those subsets. The picture below depicts how that process works for <code>v = 5</code>.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="grid_search_cv.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">5-fold Cross Validation</figcaption><p></p>
</figure>
</div>
</section>
<section id="exercise-2a-iv" class="level4">
<h4 class="anchored" data-anchor-id="exercise-2a-iv">Exercise 2a iv:</h4>
<p>Each split in the <code>fold</code> can be accessed as a variable by using the <code>$</code> operator. In order to access split <code>i</code>, we have to use the notation <code>folds$splits[[i]]</code>. By using the <code>analysis</code> function we can then access the <code>v-1</code> subsets of the original data set that are returned as a data frame. The <code>assessment</code> function returns the hold-out subset of the split.</p>
<p>Familiarize yourself with the functionality of the <code>analysis</code> and <code>assessment</code> function. For the first split, create a scatter plot for both of the subsets subsets. An example of what such plots could look like can be found below.</p>
<div class="cell">
<div class="cell-output-display">
<p><img src="Exercise_02_files/figure-html/unnamed-chunk-20-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="cell-output-display">
<p><img src="Exercise_02_files/figure-html/unnamed-chunk-21-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
</section>
<section id="exercise-2b" class="level3">
<h3 class="anchored" data-anchor-id="exercise-2b">Exercise 2b:</h3>
<p>Now that we have set up our data set for cross-validation, we can continue developing our model. The next step is to assemble the model that we wish to use. In this case, we will choose a simple linear model once again.</p>
<section id="exercise-2b-i" class="level4">
<h4 class="anchored" data-anchor-id="exercise-2b-i">Exercise 2b i:</h4>
<p>Instead of using a model created with the <code>lm</code> function of the <code>{stats}</code> package as in Exercise 1b ii, we will continue working with the <code>{tidymodels}</code> framework. The <code>{parsnip}</code> package offers a standardized interface for fitting models as well as the return values. A linear model can be created with the <code>linear_reg</code> function. Create a linear model called <code>lm_mod</code> using the <code>linear_reg</code> function. Note, that you do not have to pass any arguments to the function <code>linear_reg</code> at this point.</p>
<div class="cell">

</div>
<p>If calling the <code>lm_mod</code> object returns the same output as the one you can find below, you have solved this exercise correctly!</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>lm_mod </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Linear Regression Model Specification (regression)

Computational engine: lm </code></pre>
</div>
</div>
</section>
<section id="exercise-2b-ii" class="level4">
<h4 class="anchored" data-anchor-id="exercise-2b-ii">Exercise 2b ii:</h4>
<p>As a next step, we want to create a so-called <code>recipe</code>. According to the R Documentation, a recipe is a description of the steps to be applied to a data set in order to prepare it for data analysis. So a recipe can be thought of figuratively as a sequential procedure to cook our model!</p>
<p>In this exercise, our recipe is rather simple. Create a recipe called <code>lm_recipe</code> by using the <code>recipe</code> function. As arguments for the <code>recipe</code> function, you can pass the following formula. The second argument concerns the data that is given by the <code>data_train</code> dataset in our case.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>formula <span class="ot">&lt;-</span> totalRent <span class="sc">~</span> livingSpace</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>If calling the <code>lm_recipe</code> object returns the same output as the one you can find below, you have solved this exercise correctly!</p>
<div class="cell">
<div class="cell-output cell-output-stderr">
<pre><code></code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>â”€â”€ Recipe â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code></code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>â”€â”€ Inputs </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Number of variables by role</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>outcome:   1
predictor: 1</code></pre>
</div>
</div>
</section>
<section id="exercise-2b-iii" class="level4">
<h4 class="anchored" data-anchor-id="exercise-2b-iii">Exercise 2b iii:</h4>
<p>After creating our recipe, we create a so-called workflow. The workflow object aggregates information required to fit and predict from a model. In this case, our model <code>lm_mod</code> and the recipe <code>lm_recipe</code>. This whole procedure might seem quite complicated by now. However, later on, it will prove much more efficient and consistent this way.</p>
<p>Given the following code chunk, complete the workflow by adding the model <code>lm_mod</code> using the <code>add_model</code> function and the <code>lm_recipe</code> using the function <code>add_recipe</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>lm_wf <span class="ot">&lt;-</span> </span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">workflow</span>() <span class="sc">%&gt;%</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>  <span class="do">###################</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Continue here ##</span></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>  <span class="do">###################</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>As above, you can check whether your workflow is correct by calling it and comparing it to the following output.</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>â•â• Workflow â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
Preprocessor: Recipe
Model: linear_reg()

â”€â”€ Preprocessor â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
0 Recipe Steps

â”€â”€ Model â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Linear Regression Model Specification (regression)

Computational engine: lm </code></pre>
</div>
</div>
</section>
<section id="exercise-2b-iii-1" class="level4">
<h4 class="anchored" data-anchor-id="exercise-2b-iii-1">Exercise 2b iii:</h4>
<p>As a next step, we will specify the metrics we want to use for evaluating our model. The <code>metric_set</code> function allows us to combine multiple metric functions such as the RMSE, MAE, and Huber Loss.</p>
<p>Create an instance called <code>multi_metric</code> using the <code>metric_set</code> function. As arguments, you can pass <code>rmse,mae</code>, and, <code>huber_loss</code>.</p>
<div class="cell">

</div>
<p>As above, you can check whether your metric set <code>multi_metric</code> is correct by calling it and comparing it to the following output.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>multi_metric</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 Ã— 3
  metric     class          direction
  &lt;chr&gt;      &lt;chr&gt;          &lt;chr&gt;    
1 rmse       numeric_metric minimize 
2 mae        numeric_metric minimize 
3 huber_loss numeric_metric minimize </code></pre>
</div>
</div>
</section>
<section id="exercise-2b-iv" class="level4">
<h4 class="anchored" data-anchor-id="exercise-2b-iv">Exercise 2b iv:</h4>
<p>Now that we have fully specified our model development process we can fit the model by piping the workflow <code>lm_wf</code> to the <code>fit_resamples</code> function. As the name suggests, the <code>fit_resamples</code> function fits the linear model on each of the folds provided. We simply have to specify the <code>vfold_cv</code> object and the <code>metric_set</code> in order to train the model and calculate the metrics.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>lm_fit_rs <span class="ot">&lt;-</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>  lm_wf <span class="sc">%&gt;%</span> </span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fit_resamples</span>(folds, <span class="at">metrics =</span> multi_metric)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Familiarize yourself with the <code>collect_metrics</code> function and apply it to the <code>lm_fit_rs</code> object. The function returns the average for the respective metrics over all <strong>hold-out folds</strong> of all the splits (i.e.&nbsp;the average of all the blue cells in the illustration in Exercise 2a iii) and a few more key figures such as the standard deviation of the metric across all folds and the number of folds. A possible output can be found below.</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 Ã— 6
  .metric    .estimator  mean     n std_err .config             
  &lt;chr&gt;      &lt;chr&gt;      &lt;dbl&gt; &lt;int&gt;   &lt;dbl&gt; &lt;chr&gt;               
1 huber_loss standard    128.    10    4.71 Preprocessor1_Model1
2 mae        standard    128.    10    4.71 Preprocessor1_Model1
3 rmse       standard    160.    10    6.39 Preprocessor1_Model1</code></pre>
</div>
</div>
</section>
</section>
<section id="exercise-2c" class="level3">
<h3 class="anchored" data-anchor-id="exercise-2c">Exercise 2c:</h3>
<p>In this last exercise, we will first look at a demonstration of how to properly train multiple models within the <code>{tidymodels}</code> framework. The idea is to fit multiple polynomial regressions using cross-validation. Subsequently, it is your task to extract different hold-out sample losses and visualize them properly.</p>
<section id="exercise-2c-i" class="level4">
<h4 class="anchored" data-anchor-id="exercise-2c-i">Exercise 2c i:</h4>
<p>Carefully read the following paragraph and insert the code chunks into your own worksheet in order to solve the subsequent exercises.</p>
<hr>
<p>We first set the degree values for the polynomials we wish to fit. Similar to Exercise 2 b ii, we then create a recipe, by setting a formula and the data we want to train on. The recipe <code>rec_poly</code> is then passed to the <code>step_poly</code> function that basically creates new columns that are basis expansions of the <code>livinSpace</code> variable. Note, that as for the degree of the <code>step_poly</code> function, we did not pass <code>degree_values</code> rather than the <code>{hardhat}</code> function <code>tune()</code>. <code>tune()</code> is a placeholder for the grid <code>degree_values</code>. Why this is important will be elaborated in the explanation of the next cell (ğŸ» with me). The <code>raw = TRUE</code> parameter is passed because, in this specific example, we want to use the original (or in this case raw) values of the variable <code>livingSpace</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>degree_values <span class="ot">&lt;-</span> <span class="dv">2</span><span class="sc">:</span><span class="dv">10</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>rec_poly <span class="ot">&lt;-</span> <span class="fu">recipe</span>(</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>    totalRent <span class="sc">~</span> livingSpace, </span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> data_train</span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">step_poly</span>(</span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>      livingSpace, </span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>      <span class="at">degree =</span> <span class="fu">tune</span>(), </span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>      <span class="at">options =</span> <span class="fu">list</span>(<span class="at">raw =</span> <span class="cn">TRUE</span>)</span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a>    )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Similarly to Exercise 2b iii, we then create a workflow where we pass the model <code>lm_mod</code> we created in Exercise 2b i.</p>
<p>The real magic then happens when passing the workflow <code>poly_wf</code> to the <code>tune_grid</code> function. The <code>tune_grid</code> function basically iterates along the <code>degree_values</code>, trains the model on all the folds sequentially, and even saves the previously specified metrics in the <code>multi_metric</code> vector to the <code>tune_poly</code> object.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>poly_wf <span class="ot">&lt;-</span> <span class="fu">workflow</span>() <span class="sc">%&gt;%</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">add_model</span>(lm_mod) <span class="sc">%&gt;%</span></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">add_recipe</span>(rec_poly)</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>tune_poly <span class="ot">&lt;-</span> poly_wf <span class="sc">|&gt;</span> </span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tune_grid</span>(</span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">grid =</span> <span class="fu">tibble</span>(<span class="at">degree =</span> degree_values),</span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">metrics =</span> multi_metric,</span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">resamples =</span> folds</span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Similarly to Exercise 2b iv, we can collect the metrics for the average of all hold-out samples by using the <code>collect_metrics</code> function. However, as we have trained polynomials up to degree <code>n = 10</code>, the function returns the metrics for all polynomials with degree <code>n = 2,â€¦,10</code>.</p>
<hr>
</section>
<section id="exercise-2c-ii" class="level4">
<h4 class="anchored" data-anchor-id="exercise-2c-ii">Exercise 2c ii:</h4>
<p>Given the <code>tune_poly</code> tibble from the paragraph above, we now want to evaluate the metrics graphically. To do so, create a tibble <code>metrics_cv</code> by applying the <code>collect_metrics()</code> to the <code>tune_poly</code> tibble. The result should look similar to the output below.</p>
<div class="cell">

</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(metrics_cv)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 Ã— 7
  degree .metric    .estimator  mean     n std_err .config             
   &lt;int&gt; &lt;chr&gt;      &lt;chr&gt;      &lt;dbl&gt; &lt;int&gt;   &lt;dbl&gt; &lt;chr&gt;               
1      2 huber_loss standard    120.    10    5.12 Preprocessor1_Model1
2      2 mae        standard    121.    10    5.12 Preprocessor1_Model1
3      2 rmse       standard    158.    10    8.55 Preprocessor1_Model1
4      3 huber_loss standard    122.    10    4.86 Preprocessor2_Model1
5      3 mae        standard    122.    10    4.86 Preprocessor2_Model1
6      3 rmse       standard    160.    10    8.29 Preprocessor2_Model1</code></pre>
</div>
</div>
</section>
<section id="exercise-2c-iii" class="level4">
<h4 class="anchored" data-anchor-id="exercise-2c-iii">Exercise 2c iii:</h4>
<p>Using the <code>metrics_cv</code> tibble, create a line plot that displays different mean losses for each polynomial model. The plot should look similar to the one shown below.</p>
<div class="cell">
<div class="cell-output-display">
<p><img src="Exercise_02_files/figure-html/unnamed-chunk-36-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
</section>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "î§‹";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>